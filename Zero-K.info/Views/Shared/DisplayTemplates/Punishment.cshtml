@using ZeroKWeb
@model ZkData.Punishment
@{
    var p = Model;

    TimeSpan timeRemaining = (TimeSpan)(Model.BanExpires - DateTime.UtcNow);
    string displayIssued = $"Issued {p.Time.ToAgoString()} <span class='staticdate'>{p.Time}</span>";
    string displayExpiry = $"Expires on {p.BanExpires.Value.ToString("d")}";
    if (p.IsExpired)
    {
        displayExpiry = $"Expired {p.BanExpires.ToAgoString()} <span class='staticdate'>{p.BanExpires}</span>";
    }
    else if (timeRemaining < TimeSpan.FromDays(14))
    {
        int daysRemain = (int)timeRemaining.TotalDays;
        int hoursRemain = Math.Abs(timeRemaining.Hours);
        string timeRemain = $"{daysRemain} days, {hoursRemain} hours";
        if (timeRemaining < TimeSpan.FromDays(1))
        {
            timeRemain = $"{hoursRemain} hours";
        }
        displayExpiry = $"Expires in {timeRemain} <span class='staticdate'>{p.BanExpires}</span>";
    }
}
<div class="punishment">

    @if (p.MessageOnly && !p.hasConsequences)
    {
        <h4>Message received from moderators, click @Html.ActionLink("here", "Chat", "Lobby", new { User = ZkData.GlobalConst.NightwatchName }, null) to see it</h4>
    }
    else
    {
        <h3>@(p.hasConsequences ? "PENALTY:" : "WARNING:") @p.Reason</h3>
    }

    <div class="timeframe">
        <div class="issue">@Html.Raw(displayIssued)</div>
        <div class="expire">@Html.Raw(displayExpiry)</div>
    </div>

    <div class="consequences">
        @if (!p.hasConsequences && !p.MessageOnly)
        {
            <span class="consequence"><i class="fa fa-warning"></i> Warning</span>
        }
        @if (p.DeleteInfluence)
        {
            <span class="consequence"><i class="fa fa-moon-o"></i> PlanetWars influence deleted</span>
        }
        @if (p.DeleteXP)
        {
            <span class="consequence"><i class="fa fa-graduation-cap" XP deleted</span>
        }
        @if (p.BanCommanders)
        {
            <span class="consequence"><i class="fa fa-male"></i> Commanders blocked</span>
        }
        @if (p.BanUnlocks)
        {
            <span class="consequence"><i class="fa fa-lock"></i> Unlocks blocked</span>
        }
        @if (p.BanSpecChat)
        {
            <span class="consequence"><i class="fa fa-commenting"></i> Cannot spectator chat</span>
        }
        @if (p.BanMute)
        {
            <span class="consequence"><i class="fa fa-microphone-slash"></i> Muted</span>
        }
        @if (p.BanSite)
        {
            <span class="consequence"><i class="fa fa-sitemap"></i> Site blocked</span>
        }
        @if (p.BanForum)
        {
            <span class="consequence"><i class="fa fa-quote-left"></i> Forum blocked</span>
        }
        @if (p.BanLobby)
        {
            <span class="consequence"><i class="fa fa-gamepad"></i> Lobby blocked</span>
        }
        @if (p.SegregateHost)
        {
            <span class="consequence"><i class="fa fa-trash"></i> Segregated to troll host</span>
        }
        @if (p.BanVotes)
        {
            <span class="consequence"><i class="fa fa-thumbs-up"></i> Vote powers restricted</span>
        }
    </div>

    @if (Global.IsModerator)
    {
        <div class="admin punishdetails">
            <div class="issuedby">Issued by: @Html.PrintAccount(p.AccountByCreatedAccountID)</div>
            @if (!string.IsNullOrEmpty(p.BanIP))
            {
                <div class="blocker">IP block: @p.BanIP</div>
            }
            @if (p.UserID != null)
            {
                <div class="blocker">UserID block: @p.UserID</div>
            }
            @if (!string.IsNullOrEmpty(p.InstallID))
            {
                <div class="blocker">InstallID block: @p.InstallID</div>
            }
            <form action="@Url.Action("RemovePunishment", "Users")" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="punishmentID" value="@p.PunishmentID" />
                <input type="submit" value="Remove punishment" class="js_confirm" />
            </form>
        </div>
    }
</div>

